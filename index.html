<!DOCTYPE html>
<html lang="en" style="scroll-behavior:smooth;">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Moods.ai | Actionable Narrative Intelligence</title>
  <meta name="description" content="We spot under-priced narratives, validate them across web/social, and turn them into risk-defined trades." />
  <style>
    :root{
      --primary-color:#0a2342; --secondary-color:#2ca58d; --background-color:#f4f4f9;
      --card-background:#ffffff; --text-color:#333333; --header-text-color:#ffffff;
      --border-color:#e0e0e0; --shadow-color:rgba(0,0,0,0.08);
      --actionable-color:#28a745; --incubating-color:#fd7e14;
      --success-color:#28a745; --loss-color:#dc3545;
    }
    *{box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;margin:0;color:var(--text-color);background:var(--background-color);line-height:1.6}
    .container{max-width:1200px;margin:0 auto;padding:1rem}
    /* NAV */
    nav{position:sticky;top:0;z-index:1000;background:var(--primary-color);color:var(--header-text-color);height:60px;display:flex;align-items:center;justify-content:space-between;padding:0 1.25rem;box-shadow:0 2px 5px rgba(0,0,0,.2)}
    .logo{font-weight:800;font-size:1.25rem;color:#fff;text-decoration:none}
    .nav-left{display:flex;align-items:center;gap:12px}
    .nav-links{list-style:none;display:flex;gap:1rem;margin:0;padding:0}
    .nav-links a{color:#fff;text-decoration:none;font-weight:500;padding:.4rem 0;border-bottom:2px solid transparent;transition:border-color .2s}
    .nav-links a:hover{border-color:var(--secondary-color)}
    .hamburger{display:none;flex-direction:column;gap:4px;cursor:pointer;z-index:1001}
    .hamburger .bar{width:25px;height:3px;background:#fff;transition:.3s all}
    .feedpicker{display:flex;align-items:center;gap:.5rem;color:#fff}
    .feedpicker select{background:rgba(255,255,255,.12);color:#fff;border:1px solid rgba(255,255,255,.3);border-radius:6px;padding:.35rem .5rem}
    .feedpicker option{color:#000}
    /* HERO */
    header{background:#0a2342e0;color:#fff;text-align:center;padding:3rem 1.25rem}
    header h1{margin:0;font-weight:800;font-size:2.1rem}
    header p{max-width:760px;margin:.5rem auto 0;color:rgba(255,255,255,.9)}
    #last-updated{opacity:.85;margin:.5rem 0 0}
    /* TYPOGRAPHY/CARDS/TABLES */
    h2{color:var(--primary-color);border-bottom:2px solid var(--secondary-color);padding-bottom:.6rem;margin:2rem 0 1rem;font-size:1.6rem}
    h3{margin:.25rem 0 0}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,monospace}
    .card{background:var(--card-background);border:1px solid var(--border-color);border-left:5px solid var(--border-color);border-radius:10px;padding:20px;margin:16px 0;box-shadow:0 8px 16px var(--shadow-color)}
    .card:hover{border-left-color:var(--secondary-color)}
    .cta-button{background:var(--secondary-color);color:#fff;border:none;border-radius:8px;padding:12px 18px;font-weight:700;cursor:pointer}
    .cta-button:hover{opacity:.9}
    .disclaimer-box{background:#fffbe6;border:1px solid #ffe58f;color:#8b5e00;border-radius:8px;padding:10px 14px;font-size:.92rem;margin:.75rem 0 1rem}
    .table-responsive{overflow-x:auto;-webkit-overflow-scrolling:touch}
    table{width:100%;border-collapse:collapse;font-size:.95rem}
    thead th{background:#f8f9fa;color:var(--primary-color);text-align:left;border-bottom:1px solid var(--border-color);padding:12px 12px;cursor:pointer}
    tbody td{padding:12px 12px;border-bottom:1px solid var(--border-color);vertical-align:middle}
    tbody tr:hover{background:#f6f7f9}
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;font-size:.72rem;font-weight:800;color:#fff}
    .badge.actionable{background:var(--actionable-color)} .badge.incubating{background:var(--incubating-color)}
    .badge.ok{background:#2ca58d}.badge.warn{background:#e0a800}.badge.bad{background:#dc3545}
    .tag{display:inline-block;background:#e9eef9;color:#0a2342;padding:3px 8px;border-radius:999px;font-size:.75rem;margin:2px 6px 2px 0}
    .info-box{margin-top:12px;padding:12px;background:#eef2f5;border-left:4px solid var(--secondary-color);border-radius:6px}
    .kv{display:flex;gap:8px;align-items:flex-start;margin:.25rem 0}
    .kv strong{min-width:120px}
    .feedback-prompt{font-size:.9rem;color:#6c757d;margin-top:.5rem}
    #back-to-top{position:fixed;bottom:20px;right:20px;background:var(--secondary-color);color:#fff;border:none;border-radius:50%;width:48px;height:48px;display:none;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 6px 20px rgba(0,0,0,.2)}
    footer{text-align:center;padding:20px;color:#6c757d}
    /* MOBILE */
    @media (max-width:768px){
      .hamburger{display:flex}
      .nav-links{position:fixed;inset:0;flex-direction:column;align-items:center;gap:0;background:var(--primary-color);padding-top:80px;transform:translateX(-100%);transition:transform .25s ease}
      .nav-links.active{transform:translateX(0)}
      .nav-links li{width:100%}
      .nav-links a{display:block;width:100%;text-align:center;padding:1rem 0;border-bottom:1px solid rgba(255,255,255,.12)}
      .hamburger.active .bar:nth-child(2){opacity:0}
      .hamburger.active .bar:nth-child(1){transform:translateY(7px) rotate(45deg)}
      .hamburger.active .bar:nth-child(3){transform:translateY(-7px) rotate(-45deg)}
      /* responsive table → cards */
      .table-responsive table,.table-responsive thead,.table-responsive tbody,.table-responsive th,.table-responsive td,.table-responsive tr{display:block}
      .table-responsive thead tr{position:absolute;top:-9999px;left:-9999px}
      .table-responsive tr{border:1px solid var(--border-color);border-radius:8px;margin:0 0 12px 0;background:#fff}
      .table-responsive td{border:none;border-bottom:1px solid #eee;position:relative;padding-left:50%;text-align:right}
      .table-responsive td:before{position:absolute;left:12px;top:50%;transform:translateY(-50%);content:attr(data-label);font-weight:700;text-align:left}
    }
  </style>
</head>
<body>
  <nav>
    <div class="nav-left">
      <a href="#" class="logo">Moods.ai</a>
      <div class="feedpicker" title="Choose data source">
        <span style="font-weight:600;">Feed:</span>
        <select id="feedSelector">
          <option value="inline">Inline (this page)</option>
          <option value="auto">Auto (first available in /data)</option>
          <option value="/data/feed.json">/data/feed.json</option>
          <option value="/data/feedchatgpt.json">/data/feedchatgpt.json</option>
          <option value="/data/feedgrok.json">/data/feedgrok.json</option>
          <option value="/data/feedgemini.json">/data/feedgemini.json</option>
          <option value="ensemble">Ensemble (merge)</option>
        </select>
      </div>
    </div>
    <div class="hamburger" id="hamburger" aria-label="Menu" aria-expanded="false" role="button" tabindex="0">
      <div class="bar"></div><div class="bar"></div><div class="bar"></div>
    </div>
    <ul class="nav-links" id="navLinks">
      <li><a href="#trade-blotter">Trade Blotter</a></li>
      <li><a href="#track-record">Track Record</a></li>
      <li><a href="#theses">Theses</a></li>
      <li><a href="#incubating-ideas">Incubating</a></li>
      <li><a href="#evidence-log">Evidence</a></li>
    </ul>
  </nav>

  <header id="top">
    <h1>Actionable Narrative Intelligence</h1>
    <p>We spot under-priced narratives, validate them across web/social, and turn them into risk-defined trades.</p>
    <p id="last-updated" aria-live="polite"></p>
  </header>

  <main class="container">
    <div class="card" style="text-align:center">
      <h3>How It Works</h3>
      <p>We scan social and web data to find emerging stories, cross-verify with credible sources, and only publish trades when a clear, quantifiable edge exists.</p>
      <button class="cta-button" onclick="alert('Beta access coming soon')">Start Your Free Trial</button>
    </div>

    <!-- BLOTTTER -->
    <h2 id="trade-blotter">Actionable Trade Blotter</h2>
    <div class="disclaimer-box"><strong>Disclaimer:</strong> Educational content, not investment advice.</div>
    <div class="card table-responsive">
      <table id="blotter-table" aria-describedby="trade-blotter">
        <thead>
          <tr>
            <th data-sort="string">Ticker</th>
            <th data-sort="string">Side / Structure</th>
            <th data-sort="date">Catalyst Date</th>
            <th data-sort="date">Valid Until</th>
            <th data-sort="number">R:R</th>
            <th data-sort="number">Conf.</th>
            <th>Links</th>
          </tr>
        </thead>
        <tbody id="blotter-body"><!-- hydrated --></tbody>
      </table>
    </div>

    <!-- TRACK RECORD (static placeholder) -->
    <h2 id="track-record">Track Record (Closed Trades)</h2>
    <div class="card table-responsive">
      <table aria-describedby="track-record">
        <thead>
          <tr><th>Ticker</th><th>Strategy</th><th>Entry Date</th><th>Exit Date</th><th>Realized P/L</th><th>Status</th></tr>
        </thead>
        <tbody id="track-body">
          <!-- hydrated -->
        </tbody>
      </table>
    </div>

    <!-- THESES -->
    <section id="theses">
      <h2>Theses</h2>
      <div id="theses-container"><!-- hydrated --></div>
    </section>

    <!-- INCUBATING -->
    <h2 id="incubating-ideas">Incubating Ideas</h2>
    <div class="card" id="incubating-container">
      <!-- hydrated -->
    </div>

    <!-- EVIDENCE -->
    <h2 id="evidence-log">Evidence Log</h2>
    <div class="card table-responsive">
      <table id="evidence-table" aria-describedby="evidence-log">
        <thead>
          <tr><th>Story ID</th><th>Entity</th><th>Event Type</th><th>Source</th></tr>
        </thead>
        <tbody id="evidence-body"><!-- hydrated --></tbody>
      </table>
    </div>
  </main>

  <button id="back-to-top" title="Back to top" aria-label="Back to top">↑</button>

  <footer>
    <p>© Moods.ai — BETA. This is not financial advice.</p>
  </footer>

  <script>
    // =========================
    // INLINE FEED (the JSON above)
    // =========================
    const INLINE_FEED = {
      "generator":{"llm_name":"AcmeWriter-Alpha-v2.1","llm_version":"2.1.5-turbo-20250812","generation_time_tz":"2025-08-12T17:59:00Z","access_report":{"web_ok":true,"x_ok":false,"tiktok_ok":true,"instagram_ok":true,"apis_used":[],"skipped_families":["x"],"fallback_used":["web_domains","forums","sec.gov/edgar","investor relations"]}},
      "extractions":[
        {"doc_id":"[1]_1","module":"social_arb","story_id":"pimple_patch_trend_20250812","entity":"Pimple Patches","category":"stock","event_type":"viral","timestamp_source_tz":"2025-08-12T17:59:00Z","rationale_brief":"Viral TikTok trend for 'Pimple Patches' with high sales velocity (>4,000/day), driven by K-beauty and skin positivity movements, indicating a durable consumer shift.","source_type":"website","source_url":"https://amzscout.net/blog/viral-tiktok-products/","provenance":{"handle":null,"domain":"amzscout.net"},"brand_mentions":[],"metrics":{"price_ref":{"last":90.92,"asof_tz":"2025-08-08T20:00:00Z"},"perf":{"rel_vs_SPY_7d":-0.025,"rel_vs_SPY_14d":-0.03,"rel_vs_sector_14d":-0.015},"mom":{"rsi_14":48.5,"dma_gap_20_pct":-0.012},"vol":{"atr_14":2.15,"iv30_change":0.02,"volume_z":-0.1}},"evidence":[{"url":"https://amzscout.net/blog/viral-tiktok-products/","link_validated":true,"note":"Identifies pimple patches as a viral product category with high sales velocity and durable market drivers."}],"social_media":{"platform":"tiktok","hashtag":"#pimplepatch","sound_id":null,"views_7d":15000000,"shares_7d":750000,"likes_7d":3000000,"virality_slope":0.85,"creator_tier_mode":"macro"},"behavioral_tells":{"sold_out_mentions":0,"restock_mentions":0,"oos_rate_pct":null,"app_rank_now":null,"app_rank_delta_7d":null},"svc":{"comment_volume_change":0.75,"sentiment_change":0.6,"svc_score":0.7},"press_progression":{"first_detected_tz":"2025-08-12T10:00:00Z","first_mid_tier_press_tz":null,"first_tier1_press_tz":null,"hours_to_press":null}},
        {"doc_id":"[2]_1","module":"social_arb","story_id":"pimple_patch_trend_20250812","entity":"Hero Cosmetics Mighty Patch","category":"stock","event_type":"social_signal","timestamp_source_tz":"2025-07-30T09:00:00Z","rationale_brief":"Independent editorial review from Byrdie names Hero Cosmetics Mighty Patch 'Best Overall' pimple patch, confirming brand leadership and product quality.","source_type":"website","source_url":"https://www.byrdie.com/best-pimple-patches-11781339","provenance":{"handle":null,"domain":"byrdie.com"},"brand_mentions":[],"metrics":{"price_ref":{"last":90.92,"asof_tz":"2025-08-08T20:00:00Z"},"perf":{"rel_vs_SPY_7d":-0.025,"rel_vs_SPY_14d":-0.03,"rel_vs_sector_14d":-0.015},"mom":{"rsi_14":48.5,"dma_gap_20_pct":-0.012},"vol":{"atr_14":2.15,"iv30_change":0.02,"volume_z":-0.1}},"evidence":[{"url":"https://www.byrdie.com/best-pimple-patches-11781339","link_validated":true,"note":"Confirms brand leadership and product quality."}],"social_media":null,"behavioral_tells":null,"svc":null,"press_progression":null},
        {"doc_id":"[3]_1","module":"social_arb","story_id":"pimple_patch_trend_20250812","entity":"Hero Cosmetics Mighty Patch","category":"stock","event_type":"social_signal","timestamp_source_tz":"2025-08-12T17:59:00Z","rationale_brief":"Retail data from Target.com shows Hero Cosmetics Mighty Patch as a 'Highly rated' and 'Trending Best Seller', confirming strong consumer sales.","source_type":"website","source_url":"https://www.target.com/c/skin-care-best-sellers/patch/-/N-78vk4Z56cob","provenance":{"handle":null,"domain":"target.com"},"brand_mentions":[],"metrics":{"price_ref":{"last":90.92,"asof_tz":"2025-08-08T20:00:00Z"},"perf":{"rel_vs_SPY_7d":-0.025,"rel_vs_SPY_14d":-0.03,"rel_vs_sector_14d":-0.015},"mom":{"rsi_14":48.5,"dma_gap_20_pct":-0.012},"vol":{"atr_14":2.15,"iv30_change":0.02,"volume_z":-0.1}},"evidence":[{"url":"https://www.target.com/c/skin-care-best-sellers/patch/-/N-78vk4Z56cob","link_validated":true,"note":"Provides direct evidence of strong consumer offtake and commercial success."}],"social_media":null,"behavioral_tells":null,"svc":null,"press_progression":null},
        {"doc_id":"[4]_1","module":"social_arb","story_id":"pimple_patch_trend_20250812","entity":"CHD","category":"stock","event_type":"earnings","timestamp_source_tz":"2025-08-01T07:07:00Z","rationale_brief":"Church & Dwight's Q2 2025 earnings report explicitly names HERO™ acne products as a leading growth driver in the Consumer Domestic segment, validating the social signal's financial impact.","source_type":"official","source_url":"https://www.sec.gov/Archives/edgar/data/313927/000095017025101104/chd-ex99_1.htm","provenance":{"handle":null,"domain":"sec.gov"},"brand_mentions":[],"metrics":{"price_ref":{"last":90.92,"asof_tz":"2025-08-08T20:00:00Z"},"perf":{"rel_vs_SPY_7d":-0.025,"rel_vs_SPY_14d":-0.03,"rel_vs_sector_14d":-0.015},"mom":{"rsi_14":48.5,"dma_gap_20_pct":-0.012},"vol":{"atr_14":2.15,"iv30_change":0.02,"volume_z":-0.1}},"evidence":[{"url":"https://www.sec.gov/Archives/edgar/data/313927/000095017025101104/chd-ex99_1.htm","link_validated":true,"note":"Official company press release confirming Hero brand as a leading growth driver."}],"social_media":null,"behavioral_tells":null,"svc":null,"press_progression":null}
      ],
      "theses":[
        {"id":"CHD_HERO_GROWTH_20250812","story_id":"pimple_patch_trend_20250812","title":"Hero (CHD) benefitting from pimple patch trend","company_name":"Church & Dwight Co., Inc.","ticker":"CHD","claim":"Social and retail signals indicate sustained demand for pimple patches; CHD’s HERO brand is cited by management as a leading growth driver, implying incremental revenue/margin support.","explanation_detail":"Third-party roundups flag pimple patches as a durable viral category. Editorial reviews rank Hero’s Mighty Patch at the top. Retailer best-seller status suggests strong offtake. CHD’s Q2 commentary explicitly calls out HERO acne products as a growth driver in Consumer Domestic, supporting the link from social buzz to fundamentals.","forward_catalyst":"Sell-through updates at mass retailers, category features in mainstream press, and CHD’s next investor update/earnings commentary.","signal_origin_tz":"2025-08-12T10:00:00Z","expiry_tz":"2025-09-15T17:59:00Z","posterior_prob":0.68,"market_implied_prob":0.50,"edge_gap_pp":18,"confidence":0.95,"source_diversity_score":0.70,"confirmation_score":0.65,"priced_in_score":0.25,"novelty_stage":"emerging","hours_to_press_at_creation":null,"exposure":{"mapping":[{"brand":"HERO (Mighty Patch)","company":"Church & Dwight Co., Inc.","ticker":"CHD","exposure_type":"direct","revenue_pct_est":{"low":4.0,"mid":5.4,"high":6.5},"evidence_urls":["https://www.sec.gov/Archives/edgar/data/313927/000095017025101104/chd-ex99_1.htm","https://www.target.com/c/skin-care-best-sellers/patch/-/N-78vk4Z56cob"],"confidence":0.6}],"materiality_passed":true,"materiality_reason":"HERO is identified as a leading growth driver within CHD’s largest segment; category growth and margin mix can move consolidated results."},"evidence_doc_ids":["[1]_1","[2]_1","[3]_1","[4]_1"],"counterevidence_doc_ids":[],"entities_linked":["CHD"],"invalidation":["Retailer rankings fall materially for multiple weeks","Management walks back HERO growth commentary"]}
      ],
      "trades":[
        {"id":"trade_chd_long_20250812","story_id":"pimple_patch_trend_20250812","type":"single","strategy_class":"SINGLE_STOCK","instrument_or_strategy":"Long CHD equity","llm_origin":"AcmeWriter-Alpha-v2.1","status":"OPEN","legs":[{"ticker":"CHD","asset_type":"EQUITY","underlying":null,"dir":"LONG","weight_pct":100,"entry_price":90.92,"stop_price":86.50,"target_price_1":99.50,"target_price_2":104.00,"leg_desc":"Long CHD to capture HERO-led growth tailwind and category momentum.","option":{"type":"CUSTOM","strike":null,"strike_2":null,"expiry_tz":null,"multiplier":null}}],"side":"LONG","horizon_days":120,"confidence":0.80,"rr":1.85,"priced_in_score":0.25,"edge_score":0.77,"why_now":"Earnings commentary highlighted HERO; social/retail data still strong and not fully reflected in price.","rv_rationale":null,"catalysts":["Retailer sell-through and rankings updates","Next CHD earnings/IR commentary","Back-to-school and holiday category features"],"invalidation":["Deterioration in retailer badges/rankings","Negative guidance on HERO or category slowdown"],"valid_until_tz":"2025-09-15T17:59:00Z","context":{"last":90.92,"rel_vs_SPY_7d":-0.025,"rel_vs_SPY_14d":-0.03,"iv30_change":0.02,"volume_z":-0.1},"exposure_summary":{"ticker":"CHD","revenue_pct_mid":5.4,"exposure_type":"direct"},"thesis_ref":"CHD_HERO_GROWTH_20250812","citations":["https://amzscout.net/blog/viral-tiktok-products/","https://www.byrdie.com/best-pimple-patches-11781339","https://www.target.com/c/skin-care-best-sellers/patch/-/N-78vk4Z56cob","https://www.sec.gov/Archives/edgar/data/313927/000095017025101104/chd-ex99_1.htm"],"rumor_flag":false,"closed_pnl_pct":null,"closed_date_tz":null,"sizing":{"method":"na","neutrality_check":{"metric":"na","error_pct":0}},"pre_trade_audit":{"earnings_checked":true,"earnings_date_tz":"2025-08-01T00:00:00Z","eps_surprise_pct":0,"revenue_surprise_pct":0,"guide_change":"inline","price_reaction_1d_pct":-1.85,"price_reaction_3d_pct":-2.5,"estimate_revisions_7d":0,"thesis_debunked":false,"social_arb_status":"working","blunt_take":"Market focused on flat headline results while missing positive HERO signal; defined stop maintains risk discipline."}}
      ],
      "incubating":[],
      "state_blob":"{}"
    };

    // =========================
    // HELPERS / DOM
    // =========================
    const $  = (s, root=document) => root.querySelector(s);
    const $$ = (s, root=document) => Array.from(root.querySelectorAll(s));
    const esc = (v) => String(v == null ? '' : v);
    const hostOf = (url) => { try { return new URL(url).hostname; } catch(e){ return url||''; } };
    const fmtDate = (d) => !d ? '' : new Date(d).toLocaleString();

    // Mobile nav + back-to-top
    (function navAndTop(){
      const hamburger = $('#hamburger');
      const navLinks = $('#navLinks');
      const toggle = () => {
        hamburger.classList.toggle('active');
        hamburger.setAttribute('aria-expanded', String(hamburger.classList.contains('active')));
        navLinks.classList.toggle('active');
      };
      hamburger.addEventListener('click', toggle);
      hamburger.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); toggle(); }});
      $$('#navLinks a').forEach(a=> a.addEventListener('click', ()=> { hamburger.classList.remove('active'); hamburger.setAttribute('aria-expanded','false'); navLinks.classList.remove('active'); }));
      const b2t = $('#back-to-top');
      window.addEventListener('scroll', ()=> b2t.style.display = (document.documentElement.scrollTop > 120) ? 'flex' : 'none');
      b2t.addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}));
    })();

    // Sorting
    function sortTableByColumn(table, column, asc=true){
      const dir = asc ? 1 : -1;
      const tBody = table.tBodies[0];
      const rows = Array.from(tBody.querySelectorAll('tr'));
      const header = table.querySelector(`thead th:nth-child(${column+1})`);
      const type = header?.dataset?.sort || 'string';
      const parseCell = (td) => {
        let v = (td?.textContent||'').trim();
        if(type==='number'){ const n = parseFloat(v); return isNaN(n) ? -Infinity : n; }
        if(type==='date'){ const t = Date.parse(v); return isNaN(t) ? -Infinity : t; }
        return v.toLowerCase();
      };
      rows.sort((a,b)=>{
        const A = parseCell(a.children[column]);
        const B = parseCell(b.children[column]);
        return (A > B ? 1 : -1) * dir;
      });
      tBody.innerHTML = ''; tBody.append(...rows);
      table.querySelectorAll('th').forEach(th=>th.classList.remove('th-sort-asc','th-sort-desc'));
      header?.classList.toggle('th-sort-asc', asc); header?.classList.toggle('th-sort-desc', !asc);
    }

    // For mobile labels
    function applyDataLabels(tbodyEl){
      if(!tbodyEl) return;
      const table = tbodyEl.closest('table'); if(!table) return;
      const labels = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent.trim());
      Array.from(tbodyEl.querySelectorAll('tr')).forEach(tr=>{
        Array.from(tr.querySelectorAll('td')).forEach((td,i)=> td.setAttribute('data-label', labels[i] || ''));
      });
    }

    // =========================
    // FEED LOADING / ENSEMBLE
    // =========================
    const FEED_ORDER = [
      '/data/feed.json',
      '/data/feedchatgpt.json',
      '/data/feedgrok.json',
      '/data/feedgemini.json'
    ];

    async function tryFetch(url){
      try{
        const res = await fetch(url + (url.includes('?') ? '' : ('?ts=' + Date.now())), {cache:'no-store'});
        if(!res.ok) throw new Error('not ok');
        return await res.json();
      }catch(e){ return null; }
    }

    async function loadAuto(){
      for(const url of FEED_ORDER){
        const data = await tryFetch(url);
        if(data) return { data, label: url };
      }
      return { data:null, label:null };
    }

    function ensemble(feeds){
      // naive union for this schema
      const merged = { generator: { generation_time_tz: new Date().toISOString() }, trades:[], theses:[], extractions:[], incubating:[] };
      feeds.forEach(f=>{
        const d = f.data||{};
        merged.trades.push(...(d.trades||[]));
        merged.theses.push(...(d.theses||[]));
        merged.extractions.push(...(d.extractions||[]));
        merged.incubating.push(...(d.incubating||[]));
      });
      return merged;
    }

    // =========================
    // RENDERERS (for schema: generator, trades, theses, extractions, incubating)
    // =========================
    function hydrateFromData(data, sourceLabel=''){
      // header time
      const genTime = data?.generator?.generation_time_tz;
      $('#last-updated').textContent = (sourceLabel ? `[${sourceLabel}] ` : '') + 'Last updated: ' + (fmtDate(genTime) || 'n/a');

      // blotter from trades (OPEN only, non-rumor)
      const bb = $('#blotter-body');
      const openTrades = (data.trades||[]).filter(t => t.status==='OPEN' && !t.rumor_flag);
      const blotterRows = openTrades.map(t => {
        const leg = (t.legs||[])[0] || {};
        const sideStruct = `${leg.dir||''} / ${t.type||''}`.trim();
        const catalystDate = (t.catalysts||[]).find(c => /\d{4}-\d{2}-\d{2}/.test(c)) || ''; // best-effort
        return `<tr>
          <td class="mono">${esc(leg.ticker||t.exposure_summary?.ticker||t.ticker||'')}</td>
          <td>${esc(sideStruct || t.instrument_or_strategy || '')}</td>
          <td>${esc(catalystDate)}</td>
          <td class="mono">${esc(fmtDate(t.valid_until_tz))}</td>
          <td class="mono">${(Number(t.rr||0)).toFixed(2)}</td>
          <td>${(Number(t.confidence||0)).toFixed(2)}</td>
          <td><a href="#${esc(t.thesis_ref||'theses')}">Thesis</a> / <a href="#evidence-log">Evidence</a></td>
        </tr>`;
      }).join('');
      bb.innerHTML = blotterRows || `<tr><td colspan="7">No actionable items.</td></tr>`;
      applyDataLabels(bb);

      // track record (CLOSED)
      const tb = $('#track-body');
      const closed = (data.trades||[]).filter(t => t.status==='CLOSED');
      tb.innerHTML = closed.map(t=>{
        const leg = (t.legs||[])[0] || {};
        const statusBadge = (t.closed_pnl_pct||0) >= 0 ? '<span class="badge ok">Win</span>' : '<span class="badge bad">Loss</span>';
        return `<tr>
          <td class="mono">${esc(leg.ticker||'')}</td>
          <td>${esc(t.instrument_or_strategy||'')}</td>
          <td class="mono">${esc(fmtDate(leg.entry_date_tz||''))}</td>
          <td class="mono">${esc(fmtDate(t.closed_date_tz||''))}</td>
          <td class="mono">${(Number(t.closed_pnl_pct??0)).toFixed(1)}%</td>
          <td>${statusBadge}</td>
        </tr>`;
      }).join('') || `<tr><td colspan="6" class="mono">No closed trades yet.</td></tr>`;

      // theses cards
      const tc = $('#theses-container');
      tc.innerHTML = (data.theses||[]).map(t=>{
        const tags = [
          t.ticker ? `<span class="tag mono">${esc(t.ticker)}</span>` : '',
          t.novelty_stage ? `<span class="tag">Stage: ${esc(t.novelty_stage)}</span>` : '',
          (t.edge_gap_pp!=null) ? `<span class="tag">Edge +${esc(t.edge_gap_pp)}pp</span>` : ''
        ].join(' ');
        const exposure = (t.exposure?.mapping||[])[0] || {};
        const evUrls = exposure.evidence_urls||[];
        const evLinks = evUrls.map(u=>`<a class="tag" href="${u}" target="_blank" rel="noopener">${esc(hostOf(u))}</a>`).join(' ');
        return `<div class="card" id="${esc(t.id)}">
          <h3>${esc(t.title)}</h3>
          <div class="mono" style="opacity:.8">${esc(t.company_name||'')} ${t.ticker?`(<strong>${esc(t.ticker)}</strong>)`:''} • Signal ${esc(fmtDate(t.signal_origin_tz))}</div>
          <p style="margin:.75rem 0 1rem">${esc(t.explanation_detail||t.claim||'')}</p>
          ${tags?`<div style="margin:.25rem 0">${tags}</div>`:''}
          ${t.forward_catalyst?`<div class="info-box"><strong>Forward catalysts:</strong> ${esc(t.forward_catalyst)}</div>`:''}
          ${evLinks?`<div class="info-box"><strong>Evidence:</strong> ${evLinks}</div>`:''}
        </div>`;
      }).join('') || `<div class="card"><em>No theses available yet.</em></div>`;

      // incubating
      const ic = $('#incubating-container');
      const inc = data.incubating||[];
      ic.innerHTML = inc.length ? inc.map(i=>`
        <div class="kv"><strong>${esc(i.entity||i.story_id||'Item')}:</strong> <span>${esc(i.reason||'')}</span></div>
        <div class="kv"><strong>Review:</strong> <span>${esc(fmtDate(i.review_date_tz))}</span></div>
        <div class="kv"><strong>Rumor:</strong> <span>${i.rumor_flag?'Yes':'No'}</span></div>
      `).join('') : `<h3>New ideas will appear here as “Incubating” until confirmation/priced-in gates are met.</h3>
      <p class="info-box" style="margin:0">This section hydrates from your feed when you include it.</p>`;

      // evidence (flatten extractions[].evidence[])
      const eb = $('#evidence-body');
      const rows = (data.extractions||[]).flatMap(ex =>
        (ex.evidence||[]).map(ev => `
          <tr>
            <td>${esc(ex.story_id||'')}</td>
            <td>${esc(ex.entity||'')}</td>
            <td>${esc(ex.event_type||'')}</td>
            <td><a href="${esc(ev.url||'#')}" rel="noopener" target="_blank">${esc(hostOf(ev.url))}</a> ${ev.link_validated?'<span class="badge ok">validated</span>':'<span class="badge warn">unverified</span>'}</td>
          </tr>
        `)
      );
      eb.innerHTML = rows.length ? rows.join('') : `<tr><td colspan="4">No evidence logs.</td></tr>`;
      applyDataLabels(eb);

      // enable sorting
      const table = $('#blotter-table');
      table.querySelectorAll('thead th').forEach((th, idx)=>{
        th.addEventListener('click', ()=>{
          const asc = !th.classList.contains('th-sort-asc');
          sortTableByColumn(table, idx, asc);
        });
      });
    }

    function clearHydration(){
      $('#blotter-body').innerHTML = '';
      $('#track-body').innerHTML = '';
      $('#theses-container').innerHTML = '';
      $('#evidence-body').innerHTML = '';
      $('#last-updated').textContent = '';
      $('#incubating-container').innerHTML = '';
    }

    async function hydrateFromFeedChoice(choice){
      clearHydration();
      if(choice === 'inline'){
        hydrateFromData(INLINE_FEED, 'Inline');
        return;
      }
      if(choice === 'auto'){
        const {data,label} = await loadAuto();
        if(!data){ failHydration('No feed found (add files under /data).'); return; }
        hydrateFromData(data, label);
        return;
      }
      if(choice === 'ensemble'){
        const pulls = await Promise.all(FEED_ORDER.map(url => tryFetch(url)));
        const feeds = [];
        FEED_ORDER.forEach((url, i) => { if(pulls[i]) feeds.push({label:url, data:pulls[i]}); });
        if(!feeds.length){ failHydration('No feeds available for Ensemble.'); return; }
        const merged = ensemble(feeds);
        hydrateFromData(merged, 'Ensemble');
        return;
      }
      // specific path
      const data = await tryFetch(choice);
      if(!data){ failHydration(`Feed not found: ${choice}`); return; }
      hydrateFromData(data, choice.split('/').pop());
    }

    function failHydration(msg){
      console.warn(msg);
      $('#last-updated').textContent = msg;
      $('#blotter-body').innerHTML = `<tr><td colspan="7">${msg}</td></tr>`;
      $('#theses-container').innerHTML = `<div class="card"><em>${msg}</em></div>`;
      $('#evidence-body').innerHTML = `<tr><td colspan="4">${msg}</td></tr>`;
      $('#incubating-container').innerHTML = `<div class="card"><em>${msg}</em></div>`;
    }

    // =========================
    // INIT
    // =========================
    (async function init(){
      const selector = $('#feedSelector');
      selector.value = 'inline';
      selector.addEventListener('change', e => hydrateFromFeedChoice(e.target.value));
      await hydrateFromFeedChoice('inline');
    })();
  </script>
</body>
</html>
